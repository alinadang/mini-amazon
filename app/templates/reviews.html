{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h2>Latest Reviews</h2>
  <p class="text-muted">Enter a user ID below to see their 5 most recent reviews.</p>

  <!-- ðŸ”¹ User ID form (GET) -->
  <form method="get" action="{{ url_for('social.reviews_page') }}" class="form-inline mb-3">
    <label for="user_id" class="mr-2">User ID:</label>
    <input
      type="number"
      id="user_id"
      name="user_id"
      class="form-control mr-2"
      value="{{ user_id or '' }}"
      placeholder="e.g. 0"
      min="0"
      style="width:120px;"
      required
    >
    <button type="submit" class="btn btn-primary">Show Reviews</button>
  </form>

  {% if error %}
    <div class="alert alert-danger mt-3">{{ error }}</div>
  {% endif %}

  {% if not items or items|length == 0 %}
    {% if user_id is not none %}
      <p class="mt-3">No reviews yet for user {{ user_id }}.</p>
    {% else %}
      <p class="mt-3">Enter a user ID above to see their reviews.</p>
    {% endif %}
  {% else %}
    <table class="table table-bordered table-striped mt-3">
      <thead class="thead-dark">
        <tr>
          <th>Product ID</th>
          <th>Date</th>
          <th>Review</th>
          <th>Stars</th>
        </tr>
      </thead>
      <tbody>
        {% for r in items %}
        <tr>
          <td>{{ r.product_id }}</td>
          <td>{{ r.date_reviewed }}</td>
          <td>{{ r.comment }}</td>
          <td>
            {% set stars = (r.rating|int) %}
            {{ 'â˜…' * stars }}{{ 'â˜†' * (5 - stars) }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>

{# ðŸ”¹ Bottom bar to SUBMIT A REVIEW into Reviews table #}
<div id="feedback-bar">
  <form method="post" action="{{ url_for('social.submit_review') }}" class="container d-flex">

    <!-- User ID for the review (can be same as top; prefilled) -->
    <input
      type="number"
      name="user_id"
      class="form-control mr-2"
      placeholder="User ID"
      value="{{ user_id or '' }}"
      min="0"
      required
      style="max-width: 100px;"
    >

    <!-- Product being reviewed -->
    <input
      type="number"
      name="product_id"
      class="form-control mr-2"
      placeholder="Product ID"
      min="0"
      required
      style="max-width: 120px;"
    >

    <!-- Star rating 1â€“5 -->
    <input
      type="number"
      name="rating"
      class="form-control mr-2"
      placeholder="Stars (1-5)"
      min="1"
      max="5"
      required
      style="max-width: 120px;"
    >

    <!-- Review text -->
    <input
      type="text"
      name="comment"
      class="form-control mr-2"
      placeholder="Enter your review..."
      required
    >

    <button type="submit" class="btn btn-primary">Submit Review</button>
  </form>
</div>

<style>
  #feedback-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 8px 0;
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
    z-index: 1030; /* above main content */
  }
</style>
{% endblock %}
